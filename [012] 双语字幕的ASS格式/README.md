## 格式规范的必要性

在制作双语字幕的时候，例如中日双语，每句话两个语言分成两行渲染，两行的字体、字号等样式不同，所以需要考虑样式的切换。

### 字体地区集问题

关于使用不同字体这点，是因为不同字体的地区集不同，例如 `思源黑体` 虽然包含日语字符，但日语汉字的字形会呈现为简体字形，所以中日双语字幕需要两个不同地区集的字体。

### ASS换行渲染问题

若两行同时间的字幕行位置有相交，且它们没有 `\pos` 标签且在同一图层，其中的一行会被挤压到其他位置，类似于换行的效果，  
但这种情况在不同渲染器中的渲染效果不同，可能 VSFilter 中没有挤压的两行会在 libass 中挤压，哪行被挤压出去也不确定。

所以如果双语字幕每句分为两行、分别放不同语言，这就需要注意，要给不同语言的行分配在不同的图层。

还可以将双语都放在同一行，用换行符 `\N` 切割，并用 `\r` 标签切换样式。

## 格式样例

不管用哪种格式，都需要建立两个不同的样式，分别对应两种语言的行的样式，  
这里假设建立了两个样式 `zh` 和 `en`。

普通文字粘贴到Aegisub后会自动转为ASS格式。

### 使用自动化脚本自动切割

**推荐使用脚本做自动化**，因为下文中的手动方案都存在弊端。

这里用我自己用的脚本举例，详见 [Tag Replace 使用示例](https://github.com/op200/Tag-Replace_for_Aegisub/tree/main/doc/zh-CN#%E4%BE%8B1)

### 异行切割

一般翻译后的双语稿为单行，中间用分隔符分隔，例如用 `/` 作为分隔符，  
示例: `一二三/one two three`

单行才能便于打轴，轴完后切割为双行：

翻译稿

```
一二三/one two three
四五六/four five six
```

轴后ASS

```lua
Dialogue: 0,0:00:02.38,0:00:03.03,zh,,0,0,0,,一二三/one two three
Dialogue: 0,0:00:03.72,0:00:04.38,zh,,0,0,0,,四五六/four five six
```

异行双语ASS

```lua
Dialogue: 1,0:00:02.38,0:00:03.03,zh,,0,0,0,,一二三
Dialogue: 0,0:00:02.38,0:00:03.03,en,,0,0,0,,one two three
Dialogue: 1,0:00:03.72,0:00:04.38,zh,,0,0,0,,四五六
Dialogue: 0,0:00:03.72,0:00:04.38,en,,0,0,0,,four five six
```

这种单行切割成双行很简单，仅需 Aegisub 即可操作：  
全选所有要切割的行，复制，  
`Ctrl+H` 启用正则表达式替换，`/.*` 全部替换为空，
将图层改为 `1`，  
粘贴，`Ctrl+H` 启用正则表达式替换，`.*/` 全部替换为空，  
全选要排序的行，按时间排序。

这样就能像上文示例的那样，变成异行双语字幕了。

### 同行切割

一般翻译后的双语稿为单行，中间用分隔符分隔，例如用`/`作为分隔符，示例：`一二三/one two three`

单行才能便于打轴，轴完后切割为双行：

翻译稿

```lua
一二三/one two three
四五六/four five six
```

轴后ASS

```lua
Dialogue: 0,0:00:02.38,0:00:03.03,zh,,0,0,0,,一二三/one two three
Dialogue: 0,0:00:03.72,0:00:04.38,zh,,0,0,0,,四五六/four five six
```

同行双语ASS

```lua
Dialogue: 0,0:00:02.38,0:00:03.03,zh,,0,0,0,,一二三\N{\ren}one two three
Dialogue: 0,0:00:03.72,0:00:04.38,zh,,0,0,0,,四五六\N{\ren}four five six
```

示例里为先轴再替换，实际上先替换再轴更方便，因为是同行双语，所以不影响打轴，替换样式后反而方便打轴。

这种替换很简单，同样仅需Aegisub即可操作：  
全选所有要切割的行，  
`Ctrl + H` 启用替换，`/` 全部替换为 `\N{\ren}`。

### 异行合并为同行

有时候因为时轴之类的原因，需要将已经切割为异行的字幕合并为同行，这时候就比较复杂

异行双语ASS

```lua
Dialogue: 1,0:00:02.38,0:00:03.03,zh,,0,0,0,,一二三
Dialogue: 0,0:00:02.38,0:00:03.03,en,,0,0,0,,one two three
Dialogue: 1,0:00:03.72,0:00:04.38,zh,,0,0,0,,四五六
Dialogue: 0,0:00:03.72,0:00:04.38,en,,0,0,0,,four five six
```

合并后

```lua
Dialogue: 1,0:00:02.38,0:00:03.03,zh,,0,0,0,,一二三/one two three
Dialogue: 1,0:00:03.72,0:00:04.38,zh,,0,0,0,,四五六/four five six
```

首先用 Aegisub 将这些行按时间排序，  
使用 VSCode 之类的软件打开这个ASS，`Ctrl + H` 启用正则表达式替换，  
`^Dialogue: \d+,[\d:\.]+,[\d:\.]+,en,[^,]*,[\d:\.]+,[\d:\.]+,[\d:\.]+,[^,]*,` 全部替换为 `/`。

注意，虽然切割时不会出bug，但合并时可能会出现bug，  
因为有可能存在时间一样的行在排序后没有按想象中的顺序排序，导致合并后不同的两句合并到同一句，  
所以要尽量避免合并，如果需要合并，合并后应完整校对一遍。
