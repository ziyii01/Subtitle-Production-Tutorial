## 简介

### 内封

所谓内封字幕，就是把子集化的字体+对应的字幕封装进视频封装，播放器在播放时会载入字幕轨和附件轨里的字体子集。

不理解原理的话，建议先看前面的文章。

### 子集化

子集化字体，就是将字体子集化（好像是废话，但确实就是字面意思），例如A字体中包含字形 `{1, 2, A, b, 中, 文}`，那么这个集合的子集可以是 `{1, b, 文}`，不理解的话，可以先去搜一下集合的概念。

假如现在制作好了一个字幕，这个字幕里需要使用 `A` 字体，字幕里用到了 `{1, A, 中}` 三个字形，这时候如果把 `A` 字体整个封装进视频中，就会浪费空间，所以需要将 `A` 字体子集化，只保留 `{1, A, 中}` 这个子集，可以大量节约空间。

因为如果播放器载入的字体与系统中已安装的字体重名，可能会导致某些bug，所以子集化的字体需要改个名字，例如将 `A` 字体改名为 `A_12njf831h`，这是串随机数，保证了字体之间不重名，当然，字幕中的字体名也需要更改成对应的名字。

## 流程

子集化看起来很繁琐，实际上子集文件可以用现成的工具一键生成，不同作者制作的工具的功能大同小异，主要功能都是输出子集化后的字体和字幕文件，工具的具体使用方法可以在工具对应的说明文档里找到，大家使用自己觉得好用的子集化工具即可，这里就不赘述了。

得到了子集化的字体和字幕，并且压制好了视音频，就可以封装了，封装工具使用MKVToolNix，以下是具体流程：

### 繁化

假设现在有压制好的视音频(mkv)和制作好的简体字幕(ass)，第一步是生成繁体字幕

> **先复制一份，将前缀的尾部改成 `.zh-Hant`，也就是繁体中文的语言代码**  
> ![图像加载失败](./pic/01.avif) -> ![图像加载失败](./pic/02.avif)

> **然后用记事本编辑，`Ctrl + A` 全选，`Ctrl + X` 剪切**  
> ![图像加载失败](./pic/03.avif)

> **复制到[繁化姬](https://zhconvert.org/)，点击繁体化**  
> ![图像加载失败](./pic/04.avif)

> **复制转换后的结果**  
> ![图像加载失败](./pic/05.avif)

> **粘贴回记事本，`Ctrl + S` 保存**  
> ![图像加载失败](./pic/06.avif)

> **运行子集化程序，得到子集化的字幕和字体**  
> ![图像加载失败](./pic/07.avif)

### 封装

文件准备完毕，开始封装

> **将子集化字体丢进 `附件` 里**  
> ![图像加载失败](./pic/08.avif)

> **将视音频和字幕丢进 `输入` 里**  
> ![图像加载失败](./pic/09.avif)

> **去除FFmpeg生成的无用标签，修改音频语言(刚才已经把字幕文件的前缀尾部改成了对应语言，MKVToolNix自动识别了，所以不需要手动修改)，修改字幕的轨道名，即可完成最基本的内封字幕封装**  
> ![图像加载失败](./pic/10.avif)

## 注意事项

### 轨道信息

封装时应注意轨道信息，例如 `语言` `名称` `默认轨道`:

* 音频和字幕轨道应设定合适的语言
* 字幕轨道应设定合适的轨道名字
* 各类型轨道应都有一个默认轨

### 章节文件

若要添加章节文件，在 `输出` 中的 `章节文件` 控件中添加。

MKVToolNix 自带章节编辑器，将章节文件拖入即可编辑。

### 子集化检测

因为子集化后的字幕调用的是子集化后的字体名，所以直接用播放器播放输出的视频，即可确定子集化的效果。
